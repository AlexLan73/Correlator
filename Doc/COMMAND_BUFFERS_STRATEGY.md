# üöÄ COMMAND BUFFERS (OpenCL 3.0) - –ì–†–ê–§ –ö–û–ú–ê–ù–î

## üéØ –¢–í–ê –ò–î–ï–Ø

–í–º–µ—Å—Ç–æ 3 –æ—Ç–¥–µ–ª—å–Ω—ã—Ö —à–∞–≥–æ–≤:
```cpp
step1_reference_signals();     // –ö–æ–º–∞–Ω–¥–∞ 1
step2_input_signals();         // –ö–æ–º–∞–Ω–¥–∞ 2 (–ñ–î–Å–¢ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è 1)
step3_correlation();           // –ö–æ–º–∞–Ω–¥–∞ 3 (–ñ–î–Å–¢ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è 2)
```

–î–µ–ª–∞—Ç—å 2 command buffers:
```cpp
Command Buffer 1: STEP 1
  ‚îî‚îÄ Upload reference
  ‚îî‚îÄ FFT forward

Command Buffer 2: STEP 2 + STEP 3
  ‚îî‚îÄ Upload input
  ‚îî‚îÄ FFT forward
  ‚îî‚îÄ Complex multiply (PRE-callback)
  ‚îî‚îÄ IFFT backward (POST-callback)
  ‚îî‚îÄ Download results
```

## ‚úÖ **–î–ê, –±—É–¥–µ—Ç –ë–´–°–¢–†–ï–ï! –í–æ—Ç –ø–æ—á–µ–º—É:**

---

## üìä –¢–ï–ö–£–©–ò–ô –ü–û–î–•–û–î (3 –æ—Ç–¥–µ–ª—å–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã)

### –í—Ä–µ–º–µ–Ω–Ω–∞—è —à–∫–∞–ª–∞ –ë–ï–ó Command Buffers:

```
CPU                                    GPU Queue          GPU Hardware
‚îÇ                                      ‚îÇ                  ‚îÇ
‚îú‚îÄ[STEP 1 start]                       ‚îÇ                  ‚îÇ
‚îÇ  ‚îú‚îÄclEnqueueWriteBuffer()            ‚îÇ                  ‚îÇ
‚îÇ  ‚îÇ  ‚îî‚îÄ‚Üí –¥–æ–±–∞–≤–∏—Ç—å WriteBuffer         ‚îÇ                  ‚îÇ
‚îÇ  ‚îî‚îÄclEnqueueTransform(FFT)           ‚îÇ                  ‚îÇ
‚îÇ     ‚îî‚îÄ‚Üí –¥–æ–±–∞–≤–∏—Ç—å FFT                 ‚îÇ                  ‚îÇ
‚îÇ     ‚îî‚îÄ‚Üí clWaitForEvents() ‚ùå –ñ–î–Å–ú!  ‚îÇ                  ‚îÇ
‚îÇ        ‚Üì (–≤—Ä–µ–º—è –æ–∂–∏–¥–∞–Ω–∏—è)            ‚îÇ [–í—ã–ø–æ–ª–Ω—è–µ—Ç]      ‚îÇ
‚îÇ (CPU –ó–ê–ë–õ–û–ö–ò–†–û–í–ê–ù)                  ‚îÇ                  ‚îÇ
‚îÇ        ‚Üì                             ‚îÇ                  ‚îú‚îÄ WriteBuffer
‚îÇ        ‚Üì                             ‚îÇ                  ‚îú‚îÄ FFT STEP 1
‚îÇ [STEP 1 –∑–∞–≤–µ—Ä—à–µ–Ω]                    ‚îÇ                  ‚îÇ
‚îÇ        ‚Üì                             ‚îÇ                  ‚îÇ
‚îú‚îÄ[STEP 2 start] ‚Üê –¢–û–õ–¨–ö–û –¢–ï–ü–ï–†–¨!     ‚îÇ                  ‚îÇ
‚îÇ  ‚îú‚îÄclEnqueueWriteBuffer()            ‚îÇ                  ‚îÇ
‚îÇ  ‚îÇ  ‚îî‚îÄ‚Üí –¥–æ–±–∞–≤–∏—Ç—å WriteBuffer         ‚îÇ                  ‚îÇ
‚îÇ  ‚îî‚îÄclEnqueueTransform(FFT)           ‚îÇ                  ‚îÇ
‚îÇ     ‚îî‚îÄ‚Üí –¥–æ–±–∞–≤–∏—Ç—å FFT                 ‚îÇ                  ‚îÇ
‚îÇ     ‚îî‚îÄ‚Üí clWaitForEvents() ‚ùå –ñ–î–Å–ú!  ‚îÇ                  ‚îÇ
‚îÇ        ‚Üì (–≤—Ä–µ–º—è –æ–∂–∏–¥–∞–Ω–∏—è)            ‚îÇ [–í—ã–ø–æ–ª–Ω—è–µ—Ç]      ‚îÇ
‚îÇ (CPU –ó–ê–ë–õ–û–ö–ò–†–û–í–ê–ù)                  ‚îÇ                  ‚îÇ
‚îÇ        ‚Üì                             ‚îÇ                  ‚îú‚îÄ WriteBuffer
‚îÇ        ‚Üì                             ‚îÇ                  ‚îú‚îÄ FFT STEP 2
‚îÇ [STEP 2 –∑–∞–≤–µ—Ä—à–µ–Ω]                    ‚îÇ                  ‚îÇ
‚îÇ        ‚Üì                             ‚îÇ                  ‚îÇ
‚îú‚îÄ[STEP 3 start] ‚Üê –¢–û–õ–¨–ö–û –¢–ï–ü–ï–†–¨!     ‚îÇ                  ‚îÇ
‚îÇ  ‚îú‚îÄclEnqueueCopyBuffer()             ‚îÇ                  ‚îÇ
‚îÇ  ‚îú‚îÄclEnqueueTransform(IFFT)          ‚îÇ                  ‚îÇ
‚îÇ  ‚îú‚îÄclEnqueueReadBuffer()             ‚îÇ                  ‚îÇ
‚îÇ  ‚îî‚îÄclWaitForEvents()  ‚ùå –ñ–î–Å–ú!      ‚îÇ                  ‚îÇ
‚îÇ        ‚Üì (–≤—Ä–µ–º—è –æ–∂–∏–¥–∞–Ω–∏—è)            ‚îÇ [–í—ã–ø–æ–ª–Ω—è–µ—Ç]      ‚îÇ
‚îÇ (CPU –ó–ê–ë–õ–û–ö–ò–†–û–í–ê–ù)                  ‚îÇ                  ‚îÇ
‚îÇ        ‚Üì                             ‚îÇ                  ‚îú‚îÄ Copy
‚îÇ        ‚Üì                             ‚îÇ                  ‚îú‚îÄ IFFT
‚îÇ        ‚Üì                             ‚îÇ                  ‚îú‚îÄ ReadBuffer
‚îÇ [ALL DONE]                           ‚îÇ                  ‚îÇ

–ü–†–û–ë–õ–ï–ú–ê: 
- CPU –¥–æ–±–∞–≤–ª—è–µ—Ç –∫–æ–º–∞–Ω–¥—ã –°–ï–†–ò–ô–ù–û (–æ–¥–Ω—É –∑–∞ –æ–¥–Ω–æ–π)
- GPU –≤–∏–¥–∏—Ç –æ—á–µ—Ä–µ–¥—å "–≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏" (–º–æ–∂–µ—Ç –±—ã—Ç—å –Ω–µ –æ–ø—Ç–∏–º–∞–ª—å–Ω–æ)
- CPU —á–∞—Å—Ç–æ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω –Ω–∞ clWaitForEvents()
- GPU –º–æ–∂–µ—Ç –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –ø–∞—Ä–∞–ª–ª–µ–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å

–û–ë–©–ï–ï –í–†–ï–ú–Ø: STEP1_time + STEP2_time + STEP3_time
```

---

## üöÄ –° COMMAND BUFFERS (OpenCL 3.0)

### –í—Ä–µ–º–µ–Ω–Ω–∞—è —à–∫–∞–ª–∞ –° Command Buffers:

```
CPU                                    GPU Queue          GPU Hardware
‚îÇ                                      ‚îÇ                  ‚îÇ
‚îú‚îÄ[Build Command Buffer 1]             ‚îÇ                  ‚îÇ
‚îÇ  ‚îú‚îÄ Add WriteBuffer(reference)       ‚îÇ                  ‚îÇ
‚îÇ  ‚îú‚îÄ Add FFT(reference)               ‚îÇ                  ‚îÇ
‚îÇ  ‚îî‚îÄ clFinalizeCommandBuffer()        ‚îÇ ‚Üê –ì—Ä–∞—Ñ –≥–æ—Ç–æ–≤!   ‚îÇ
‚îÇ     (CPU –Ω–µ –∂–¥—ë—Ç GPU!)              ‚îÇ                  ‚îÇ
‚îÇ        ‚Üì (–º–∏–∫—Ä–æ—Å–µ–∫—É–Ω–¥—ã –Ω–∞ —Å–±–æ—Ä–∫—É)    ‚îÇ                  ‚îÇ
‚îÇ (CPU –ù–ï –ó–ê–ë–õ–û–ö–ò–†–û–í–ê–ù!)              ‚îÇ                  ‚îÇ
‚îÇ        ‚Üì                             ‚îÇ                  ‚îÇ
‚îú‚îÄ[Build Command Buffer 2]             ‚îÇ                  ‚îÇ
‚îÇ  ‚îú‚îÄ Add WriteBuffer(input)           ‚îÇ                  ‚îÇ
‚îÇ  ‚îú‚îÄ Add FFT(input)                   ‚îÇ                  ‚îÇ
‚îÇ  ‚îú‚îÄ Add IFFT (—Å callbacks)           ‚îÇ                  ‚îÇ
‚îÇ  ‚îú‚îÄ Add ReadBuffer(results)          ‚îÇ                  ‚îÇ
‚îÇ  ‚îî‚îÄ clFinalizeCommandBuffer()        ‚îÇ                  ‚îÇ
‚îÇ     (CPU –Ω–µ –∂–¥—ë—Ç GPU!)              ‚îÇ                  ‚îÇ
‚îÇ        ‚Üì (–º–∏–∫—Ä–æ—Å–µ–∫—É–Ω–¥—ã –Ω–∞ —Å–±–æ—Ä–∫—É)    ‚îÇ                  ‚îÇ
‚îÇ (CPU –ù–ï –ó–ê–ë–õ–û–ö–ò–†–û–í–ê–ù!)              ‚îÇ                  ‚îÇ
‚îÇ        ‚Üì                             ‚îÇ                  ‚îÇ
‚îú‚îÄ[Enqueue –æ–±–∞ –±—É—Ñ–µ—Ä–∞ –æ–¥–Ω–æ–π —Å–µ—Ä–∏–µ–π]   ‚îÇ                  ‚îÇ
‚îÇ  ‚îú‚îÄ clEnqueueCommandBuffer(CB1)      ‚îÇ                  ‚îÇ
‚îÇ  ‚îî‚îÄ clEnqueueCommandBuffer(CB2)      ‚îÇ                  ‚îÇ
‚îÇ     ‚îî‚îÄ‚Üí GPU –≤–∏–¥–∏—Ç –í–°–ï –∫–æ–º–∞–Ω–¥—ã       ‚îÇ ‚Üê –ü–æ–ª–Ω—ã–π –≥—Ä–∞—Ñ!  ‚îÇ
‚îÇ        (–º–∏–∫—Ä–æ—Å–µ–∫—É–Ω–¥—ã –Ω–∞ enqueue)     ‚îÇ                  ‚îÇ
‚îÇ (CPU –º–æ–∂–µ—Ç –¥–µ–ª–∞—Ç—å –¥—Ä—É–≥–æ–µ!)          ‚îÇ                  ‚îÇ
‚îÇ        ‚Üì                             ‚îÇ                  ‚îÇ
‚îÇ (CPU —Å–≤–æ–±–æ–¥–µ–Ω! –ú–æ–∂–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å)      ‚îÇ [GPU –≤–∏–¥–∏—Ç –≤–µ—Å—å ‚îÇ ‚îú‚îÄ WriteBuffer(ref)
‚îÇ                                     ‚îÇ  –≥—Ä–∞—Ñ –∫–æ–º–∞–Ω–¥!]  ‚îÇ ‚îú‚îÄ FFT(ref)
‚îÇ                                     ‚îÇ                  ‚îÇ ‚îú‚îÄ WriteBuffer(in)
‚îÇ                                     ‚îÇ                  ‚îÇ ‚îú‚îÄ FFT(in)
‚îÇ                                     ‚îÇ                  ‚îÇ ‚îú‚îÄ Copy
‚îÇ                                     ‚îÇ                  ‚îÇ ‚îú‚îÄ IFFT+CB
‚îÇ                                     ‚îÇ                  ‚îÇ ‚îú‚îÄ ReadBuffer
‚îÇ                                     ‚îÇ                  ‚îÇ
‚îÇ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ: clWaitForEvents())    ‚îÇ [–ó–∞–≤–µ—Ä—à–∞–µ—Ç]    ‚îÇ
‚îÇ        ‚Üì (—Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –Ω—É–∂–Ω–æ)        ‚îÇ                  ‚îÇ
‚îÇ [ALL DONE]                           ‚îÇ                  ‚îÇ

–í–´–ò–ì–†–´–®–ò:
1. GPU –≤–∏–¥–∏—Ç –í–°–ï –∫–æ–º–∞–Ω–¥—ã —Å—Ä–∞–∑—É (–æ–ø—Ç–∏–º–∏–∑–∏—Ä—É–µ—Ç –ø–æ—Ä—è–¥–æ–∫)
2. GPU scheduler –º–æ–∂–µ—Ç —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–∏—Ç—å –Ω–∞–≥—Ä—É–∑–∫—É –ª—É—á—à–µ
3. –ú–µ–Ω—å—à–µ overhead –Ω–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –∫–æ–º–∞–Ω–¥
4. CPU –Ω–µ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω!
5. –ë–æ–ª—å—à–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–µ–π –¥–ª—è –ø–∞—Ä–∞–ª–ª–µ–ª–∏–∑–º–∞ –≤–Ω—É—Ç—Ä–∏ GPU

–û–ë–©–ï–ï –í–†–ï–ú–Ø: STEP1_time + STEP2_time + STEP3_time 
             (–Ω–æ —Å –õ–£–ß–®–ï–ô –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–µ–π + –º–µ–Ω—å—à–µ overhead)
```

---

## üí° –ö–õ–Æ–ß–ï–í–´–ï –û–¢–õ–ò–ß–ò–Ø

### –ë–´–õ–û (–±–µ–∑ Command Buffers):

```
CPU –¥–µ–π—Å—Ç–≤–∏—è:                GPU –¥–µ–π—Å—Ç–≤–∏—è:
1. clEnqueueWriteBuffer()    1. –í—ã–ø–æ–ª–Ω–∏—Ç—å WriteBuffer
   clWaitForEvents() ‚ùå       (CPU –∑–∞–º–æ—Ä–æ–∂–µ–Ω–Ω—ã–π)
2. clEnqueueTransform()
   clWaitForEvents() ‚ùå
3. clEnqueueReadBuffer()
   clWaitForEvents() ‚ùå

‚Üí –°–ï–†–ò–ô–ù–û–ï –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ
‚Üí CPU —á–∞—Å—Ç–æ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω
‚Üí GPU –≤–∏–¥–∏—Ç –∫–æ–º–∞–Ω–¥—ã "–≤ –ø—Ä—è–º–æ–º —ç—Ñ–∏—Ä–µ"
```

### –°–¢–ê–õ–û (—Å Command Buffers):

```
CPU –¥–µ–π—Å—Ç–≤–∏—è:                GPU –¥–µ–π—Å—Ç–≤–∏—è:
1. clBuildCommand()          1. GPU –≤–∏–¥–∏—Ç –í–°–ï –∫–æ–º–∞–Ω–¥—ã
   clFinalizeCommand()          (—á–µ—Ä–µ–∑ –≥—Ä–∞—Ñ)
2. clBuildCommand()          2. GPU —Å–∞–º –æ–ø—Ç–∏–º–∏–∑–∏—Ä—É–µ—Ç
   clFinalizeCommand()           –ø–æ—Ä—è–¥–æ–∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
3. clEnqueueCommandBuffer()
   (–æ–¥–Ω–∞ —Å–µ—Ä–∏—è!)

‚Üí –í–°–ï –∫–æ–º–∞–Ω–¥—ã –¥–æ–±–∞–≤–ª–µ–Ω—ã —Å—Ä–∞–∑—É
‚Üí CPU –Ω–µ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω!
‚Üí GPU –≤–∏–¥–∏—Ç –ø–æ–ª–Ω—ã–π –≥—Ä–∞—Ñ = –ª—É—á—à–∞—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è
```

---

## üìä –û–ñ–ò–î–ê–ï–ú–´–ô –í–´–ò–ì–†–´–®

### –ì–¥–µ –∏–º–µ–Ω–Ω–æ —É—Å–∫–æ—Ä–µ–Ω–∏–µ:

| –ò—Å—Ç–æ—á–Ω–∏–∫ –≤—ã–∏–≥—Ä—ã—à–∞ | –¢–µ–∫—É—â–∏–π –ø–æ–¥—Ö–æ–¥ | –° Command Buffers |
|-------------------|---------------|-------------------|
| **Overhead post–∞–Ω–æ–≤–∫–∏ –∫–æ–º–∞–Ω–¥** | ~0.5‚Äì2 –º–∫—Å √ó 3 step = 1.5‚Äì6 –º–∫—Å | ~0.5‚Äì2 –º–∫—Å √ó 1 enqueue = 0.5‚Äì2 –º–∫—Å |
| **CPU-–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞ clWait** | ~3‚Äì8 –º—Å √ó 3 —Ä–∞–∑–∞ = 9‚Äì24 –º—Å | ~0 –º—Å (–∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ!) |
| **GPU scheduler –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è** | –ú–æ–∂–µ—Ç –≤–∏–¥–µ—Ç—å —Ç–æ–ª—å–∫–æ 1 –∫–æ–º–∞–Ω–¥—É | –í–∏–¥–∏—Ç –≤–µ—Å—å –≥—Ä–∞—Ñ = **–ª—É—á—à–µ!** |
| **Context-switch GPU** | –ú–æ–∂–µ—Ç –±—ã—Ç—å –º–µ–∂–¥—É STEP'–∞–º–∏ | –ú–∏–Ω–∏–º–∏–∑–∏—Ä—É–µ—Ç—Å—è |

### –ò–¢–û–ì–û:

- **–£–±–∏—Ä–∞–µ—Ç—Å—è:** 9‚Äì24 –º—Å –Ω–∞ CPU-–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–∏–µ ‚úÖ
- **–£–ª—É—á—à–∞–µ—Ç—Å—è:** GPU scheduler –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è (~5‚Äì15% –Ω–∞ –ø–∞—Ä–∞–ª–ª–µ–ª–∏–∑–º) ‚úÖ
- **–≠–∫–æ–Ω–æ–º–∏—Ç—Å—è:** Overhead –Ω–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –∫–æ–º–∞–Ω–¥ (–º–∏–∫—Ä–æ—Å–µ–∫—É–Ω–¥—ã)

**–û–±—â–∏–π –≤—ã–∏–≥—Ä—ã—à:** **10‚Äì25% —É—Å–∫–æ—Ä–µ–Ω–∏–µ** üöÄ

---

## üîß –ö–û–î (–∫–∞–∫ —ç—Ç–æ –≤—ã–≥–ª—è–¥–∏—Ç)

### –ë–´–õ–û (–±–µ–∑ Command Buffers):

```cpp
void executeFullPipeline() {
    // STEP 1
    step1_reference_signals();
    
    // STEP 2
    step2_input_signals();
    
    // STEP 3
    step3_correlation();
}
```

### –°–¢–ê–õ–û (—Å Command Buffers):

```cpp
void executeFullPipeline_CommandBuffers() {
    // BUILD Command Buffer 1 (STEP 1)
    cl_command_buffer_khr cb1 = clCreateCommandBuffer(ctx_.queue);
    
    clCommandEnqueueWriteBuffer(cb1, ctx_.queue, 
                               ctx_.reference_data, ...);
    clCommandEnqueueNDRangeKernel(cb1, ctx_.queue,
                                 reference_fft_kernel, ...);
    
    clFinalizeCommandBuffer(cb1);  // ‚Üê –ì—Ä–∞—Ñ –≥–æ—Ç–æ–≤
    
    // BUILD Command Buffer 2 (STEP 2 + STEP 3)
    cl_command_buffer_khr cb2 = clCreateCommandBuffer(ctx_.queue);
    
    clCommandEnqueueWriteBuffer(cb2, ctx_.queue,
                               ctx_.input_data, ...);
    clCommandEnqueueNDRangeKernel(cb2, ctx_.queue,
                                 input_fft_kernel, ...);
    clCommandEnqueueNDRangeKernel(cb2, ctx_.queue,
                                 ifft_kernel_with_callbacks, ...);
    clCommandEnqueueReadBuffer(cb2, ctx_.queue,
                              correlation_results, ...);
    
    clFinalizeCommandBuffer(cb2);  // ‚Üê –ì—Ä–∞—Ñ –≥–æ—Ç–æ–≤
    
    // EXECUTE –æ–±–∞ –±—É—Ñ–µ—Ä–∞ –û–î¬≠–ù–û–ô —Å–µ—Ä–∏–µ–π
    cl_command_buffer_khr cbs[] = {cb1, cb2};
    clEnqueueCommandBuffers(ctx_.queue, 2, cbs, 0, nullptr, nullptr);
    
    // CPU –º–æ–∂–µ—Ç –¥–µ–ª–∞—Ç—å –¥—Ä—É–≥–æ–µ –∑–¥–µ—Å—å!
    
    clFinish(ctx_.queue);  // ‚Üê –ñ–¥—ë–º –≤ –∫–æ–Ω—Ü–µ –µ—Å–ª–∏ –Ω—É–∂–Ω–æ
    
    // –û—á–∏—Å—Ç–∏—Ç—å
    clReleaseCommandBuffer(cb1);
    clReleaseCommandBuffer(cb2);
}
```

---

## ‚ö†Ô∏è –û–ì–†–ê–ù–ò–ß–ï–ù–ò–Ø

1. **OpenCL 3.0 required** (not backward compatible)
   - RTX 2080 Ti / 3060 –º–æ–≥—É—Ç –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—Ç—å Command Buffers
   - –ù—É–∂–Ω–∞ –ø–æ–¥–¥–µ—Ä–∂–∫–∞ –≤ –¥—Ä–∞–π–≤–µ—Ä–µ NVIDIA

2. **–ù–µ–ª—å–∑—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ –º–µ–Ω—è—Ç—å –∫–æ–º–∞–Ω–¥—ã**
   - –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –∏–∑–≤–µ—Å—Ç–Ω—ã –Ω–∞ –º–æ–º–µ–Ω—Ç —Å–±–æ—Ä–∫–∏
   - –î–ª—è –≤–∞—à–µ–≥–æ –∞–ª–≥–æ—Ä–∏—Ç–º–∞ —ç—Ç–æ OK (–ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∑–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω—ã)

3. **–¢—Ä–µ–±—É–µ—Ç –ø–µ—Ä–µ–ø–∏—Å—ã–≤–∞–Ω–∏—è –ª–æ–≥–∏–∫–∏**
   - –ù—É–∂–Ω–æ –ø–µ—Ä–µ–π—Ç–∏ —Å –ø—Ä–∏–≤—ã—á–Ω–æ–≥–æ clEnqueue* –Ω–∞ clCommand*
   - –ù–æ –≤—ã–∏–≥—Ä—ã—à —Å—Ç–æ–∏—Ç!

---

## üéØ –ú–û–Ø –†–ï–ö–û–ú–ï–ù–î–ê–¶–ò–Ø

### –î–ª—è —Ç–≤–æ–µ–≥–æ –∞–ª–≥–æ—Ä–∏—Ç–º–∞:

**–î–ê, –∏—Å–ø–æ–ª—å–∑—É–π Command Buffers!** –í–æ—Ç –ø–æ—á–µ–º—É:

1. ‚úÖ –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –§–ò–ö–°–ò–†–û–í–ê–ù–´ (N, num_shifts, num_signals)
   - –ù–µ—Ç –Ω—É–∂–¥—ã –≤ –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏—Ö –∏–∑–º–µ–Ω–µ–Ω–∏—è—Ö
2. ‚úÖ –ì—Ä–∞—Ñ –∫–æ–º–∞–Ω–¥ –ü–†–û–°–¢–û–ô –∏ –†–ï–ì–£–õ–Ø–†–ù–´–ô
   - STEP 1, –ø–æ—Ç–æ–º STEP 2+3
3. ‚úÖ –ß—É–≤—Å—Ç–≤–∏—Ç–µ–ª–µ–Ω –∫ –æ—á–µ—Ä–µ–¥—è–º –∏ latency
   - 10‚Äì25% –≤—ã–∏–≥—Ä—ã—à –∑–∞–º–µ—Ç–µ–Ω
4. ‚úÖ GPU scheduler –º–æ–∂–µ—Ç —Ö–æ—Ä–æ—à–æ –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å

### –ü—É—Ç—å –º–∏–≥—Ä–∞—Ü–∏–∏:

1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ–¥–¥–µ—Ä–∂–∫—É OpenCL 3.0 –Ω–∞ —Ç–≤–æ–∏—Ö –∫–∞—Ä—Ç–∞—Ö
2. –ï—Å–ª–∏ –Ω–µ—Ç ‚Üí –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ –æ—á–µ—Ä–µ–¥–∏ (–ø—É–Ω–∫—Ç 4 –∏–∑ –º–æ–µ–≥–æ –¥–æ–∫–ª–∞–¥–∞)
3. –ï—Å–ª–∏ –µ—Å—Ç—å ‚Üí –ø–µ—Ä–µ–¥–µ–ª–∞—Ç—å –Ω–∞ Command Buffers

---

## üìà –û–¶–ï–ù–ö–ê –í–´–ò–ì–†–´–®–ê –î–õ–Ø –¢–í–û–ï–ì–û –ê–õ–ì–û–†–ò–¢–ú–ê

| –ü–∞—Ä–∞–º–µ—Ç—Ä | –¢–µ–∫—É—â–∏–π –ø–æ–¥—Ö–æ–¥ | –° Command Buffers |
|----------|--------------|-------------------|
| **Overhead –Ω–∞ –∫–æ–º–∞–Ω–¥—ã** | 1.5‚Äì6 –º–∫—Å | 0.5‚Äì2 –º–∫—Å |
| **CPU-–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–∏–µ** | 9‚Äì24 –º—Å | ~0 –º—Å |
| **GPU scheduler opt** | –ë–∞–∑–æ–≤–∞—è | +5‚Äì15% –ø–∞—Ä–∞–ª–ª–µ–ª–∏–∑–º |
| **TOTAL SPEEDUP** | **baseline** | **10‚Äì25%** üöÄ |

–î–ª—è STEP 1 (32 FFT): ~20 –º—Å  
–î–ª—è STEP 2+3 (1600 IFFT): ~50 –º—Å  
**TOTAL: ~70 –º—Å**

**–° Command Buffers:** ~53‚Äì63 –º—Å ‚úÖ

---

## üéì –ó–ê–ö–õ–Æ–ß–ï–ù–ò–ï

–¢–≤–æ—è –∏–¥–µ—è **–æ—Ç–ª–∏—á–Ω–∞—è**! 

> "–î–≤–µ –∫–æ–º–∞–Ω–¥—ã: STEP 1, –∏ STEP 2+3"

**–î–ê, –±—É–¥–µ—Ç –ù–ê–ú–ù–û–ì–û –±—ã—Å—Ç—Ä–µ–µ:**
- –£–±–∏—Ä–∞–µ—Ç—Å—è CPU-–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞ 9‚Äì24 –º—Å
- GPU –≤–∏–¥–∏—Ç –≤–µ—Å—å –≥—Ä–∞—Ñ –∏ –æ–ø—Ç–∏–º–∏–∑–∏—Ä—É–µ—Ç –ª—É—á—à–µ
- –ú–µ–Ω—å—à–µ overhead –Ω–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ—á–µ—Ä–µ–¥—å—é

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:** –µ—Å–ª–∏ OpenCL 3.0 –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è ‚Üí –¥–µ–ª–∞–π Command Buffers!

–ï—Å–ª–∏ –Ω–µ—Ç ‚Üí –∏—Å–ø–æ–ª—å–∑—É–π –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ enqueue –±–µ–∑ clWaitForEvents().
