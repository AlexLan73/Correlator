# üîß –ü–ª–∞–Ω —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞ Correlator

## üìä –ê–Ω–∞–ª–∏–∑ —Ç–µ–∫—É—â–µ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è

### –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∫–æ–¥–∞:
- **–û–±—â–∏–π —Ä–∞–∑–º–µ—Ä**: ~6641 —Å—Ç—Ä–æ–∫
- **Debug –≤—ã–≤–æ–¥**: 184+ printf/fprintf –≤ fft_handler.cpp
- **–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–±–ª–µ–º—ã**: –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å, –Ω–∞–¥–µ–∂–Ω–æ—Å—Ç—å, –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º–æ—Å—Ç—å

---

## üéØ –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç–Ω—ã–µ –æ–±–ª–∞—Å—Ç–∏ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞

### 1. ‚ö° –ü–†–û–ò–ó–í–û–î–ò–¢–ï–õ–¨–ù–û–°–¢–¨ (–ö–†–ò–¢–ò–ß–ù–û)

#### 1.1. –£—Å–ª–æ–≤–Ω—ã–π debug –≤—ã–≤–æ–¥
**–ü—Ä–æ–±–ª–µ–º–∞:** 184+ printf –≤ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–æ–º –ø—É—Ç–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
```cpp
// –°–µ–π—á–∞—Å –≤–µ–∑–¥–µ:
printf("[STEP 1] Processing...\n");
printf("  [DEBUG] Step1 parameters check:\n");

// –ù—É–∂–Ω–æ:
#ifdef DEBUG_VERBOSE
    DEBUG_LOG("[STEP 1] Processing...\n");
#endif
```

**–†–µ—à–µ–Ω–∏–µ:**
- –î–æ–±–∞–≤–∏—Ç—å –º–∞–∫—Ä–æ—Å `DEBUG_LOG` / `VERBOSE_LOG`
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —É—Å–ª–æ–≤–Ω—É—é –∫–æ–º–ø–∏–ª—è—Ü–∏—é
- –û—Å—Ç–∞–≤–∏—Ç—å —Ç–æ–ª—å–∫–æ –∫—Ä–∏—Ç–∏—á–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –æ–± –æ—à–∏–±–∫–∞—Ö

**–û–∂–∏–¥–∞–µ–º—ã–π —ç—Ñ—Ñ–µ–∫—Ç:** +5-10% –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

#### 1.2. –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Å–æ–±—ã—Ç–∏–π OpenCL
**–ü—Ä–æ–±–ª–µ–º–∞:** –ú–Ω–æ–≥–æ –ø—Ä–æ–≤–µ—Ä–æ–∫ –∏ wait'–æ–≤
```cpp
if (event_fft) {
    err = clWaitForEvents(1, &event_fft);
    if (err != CL_SUCCESS) { ... }
}
```

**–†–µ—à–µ–Ω–∏–µ:**
- –°–æ–∑–¥–∞—Ç—å RAII –æ–±–µ—Ä—Ç–∫—É –¥–ª—è cl_event
- Batch wait –¥–ª—è –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö —Å–æ–±—ã—Ç–∏–π
- –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –≥–¥–µ –≤–æ–∑–º–æ–∂–Ω–æ

---

### 2. üõ°Ô∏è –ù–ê–î–ï–ñ–ù–û–°–¢–¨

#### 2.1. RAII –¥–ª—è OpenCL —Ä–µ—Å—É—Ä—Å–æ–≤
**–ü—Ä–æ–±–ª–µ–º–∞:** –†—É—á–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–∞–º—è—Ç—å—é, —Ä–∏—Å–∫ —É—Ç–µ—á–µ–∫
```cpp
cl_mem buffer = clCreateBuffer(...);
// ... –∫–æ–¥ ...
clReleaseMemObject(buffer); // –ª–µ–≥–∫–æ –∑–∞–±—ã—Ç—å –ø—Ä–∏ exception
```

**–†–µ—à–µ–Ω–∏–µ:**
```cpp
class OpenCLBuffer {
    cl_mem handle_;
public:
    OpenCLBuffer(cl_context ctx, size_t size, cl_int* err);
    ~OpenCLBuffer() { if (handle_) clReleaseMemObject(handle_); }
    // Rule of 5
};
```

**–≠—Ñ—Ñ–µ–∫—Ç:** –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ—Å–≤–æ–±–æ–∂–¥–µ–Ω–∏–µ –ø—Ä–∏ –∏—Å–∫–ª—é—á–µ–Ω–∏—è—Ö

#### 2.2. –£–ª—É—á—à–µ–Ω–∏–µ cleanup()
**–¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ:** –ï—Å—Ç—å –∑–∞—â–∏—Ç–∞ –æ—Ç –¥–≤–æ–π–Ω–æ–≥–æ cleanup, –Ω–æ –º–æ–∂–Ω–æ —É–ª—É—á—à–∏—Ç—å

**–£–ª—É—á—à–µ–Ω–∏—è:**
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å std::atomic –¥–ª—è —Ñ–ª–∞–≥–∞ is_cleaned_up
- RAII –¥–ª—è –≤—Å–µ—Ö —Ä–µ—Å—É—Ä—Å–æ–≤ (—É–±—Ä–∞—Ç—å —Ä—É—á–Ω–æ–π cleanup)
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤–∞–ª–∏–¥–Ω–æ—Å—Ç–∏ –ø–µ—Ä–µ–¥ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º

---

### 3. üìê –ê–†–•–ò–¢–ï–ö–¢–£–†–ê

#### 3.1. –†–∞–∑–¥–µ–ª–µ–Ω–∏–µ –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏ –≤ FFTHandler
**–ü—Ä–æ–±–ª–µ–º–∞:** FFTHandler –¥–µ–ª–∞–µ—Ç —Å–ª–∏—à–∫–æ–º –º–Ω–æ–≥–æ:
- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ OpenCL –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–º
- –°–æ–∑–¥–∞–Ω–∏–µ –ø–ª–∞–Ω–æ–≤
- –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–π
- –ü—Ä–æ—Ñ–∏–ª–∏—Ä–æ–≤–∞–Ω–∏–µ
- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –±—É—Ñ–µ—Ä–∞–º–∏

**–†–µ—à–µ–Ω–∏–µ:** –†–∞–∑–¥–µ–ª–∏—Ç—å –Ω–∞ –∫–ª–∞—Å—Å—ã:
```cpp
class OpenCLResourceManager {
    // –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –±—É—Ñ–µ—Ä–∞–º–∏, –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–º, –æ—á–µ—Ä–µ–¥—å—é
};

class FFTPlanManager {
    // –°–æ–∑–¥–∞–Ω–∏–µ –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ FFT –ø–ª–∞–Ω–∞–º–∏
};

class FFTExecutor {
    // –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–π Step1/Step2/Step3
};
```

#### 3.2. –£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è –∫–æ–¥–∞
**–ü—Ä–æ–±–ª–µ–º–∞:** step1 –∏ step2 –æ—á–µ–Ω—å –ø–æ—Ö–æ–∂–∏

**–†–µ—à–µ–Ω–∏–µ:** –û–±—â–∏–π —à–∞–±–ª–æ–Ω:
```cpp
template<typename DataType>
void executeFFTStep(
    const DataType* host_data,
    size_t data_size,
    cl_mem gpu_input,
    cl_mem gpu_output,
    clfftPlanHandle plan,
    OperationTiming& timing
);
```

---

### 4. üìù –ö–û–î–û–í–ê–Ø –ë–ê–ó–ê

#### 4.1. –ö–æ–Ω—Å—Ç–∞–Ω—Ç—ã –≤–º–µ—Å—Ç–æ –º–∞–≥–∏—á–µ—Å–∫–∏—Ö —á–∏—Å–µ–ª
```cpp
// –°–µ–π—á–∞—Å:
const size_t N = (1 << 15);  // 32768

// –ù—É–∂–Ω–æ:
namespace Constants {
    constexpr size_t DEFAULT_FFT_SIZE = 32768;
    constexpr int DEFAULT_NUM_SHIFTS = 40;
    constexpr int DEFAULT_NUM_SIGNALS = 50;
}
```

#### 4.2. –£–Ω–∏—Ñ–∏–∫–∞—Ü–∏—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—à–∏–±–æ–∫
**–°–µ–π—á–∞—Å:** –†–∞–∑–Ω—ã–µ —Å—Ç–∏–ª–∏
```cpp
if (err != CL_SUCCESS) throw std::runtime_error(...);
if (!buffer) fprintf(stderr, "ERROR: ...");
```

**–ù—É–∂–Ω–æ:** –ï–¥–∏–Ω—ã–π –ø–æ–¥—Ö–æ–¥
```cpp
#define CHECK_CL_ERROR(err, msg) \
    if ((err) != CL_SUCCESS) { \
        throw OpenCLError((err), (msg), __FILE__, __LINE__); \
    }

class OpenCLError : public std::runtime_error {
    cl_int error_code_;
};
```

---

## üìã –ü–ª–∞–Ω —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ (–ø–æ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–∞–º)

### –§–∞–∑–∞ 1: –ë—ã—Å—Ç—Ä—ã–µ —É–ª—É—á—à–µ–Ω–∏—è (1-2 –¥–Ω—è)
1. ‚úÖ –£—Å–ª–æ–≤–Ω—ã–π debug –≤—ã–≤–æ–¥ (–º–∞–∫—Ä–æ—Å—ã)
2. ‚úÖ RAII –¥–ª—è cl_event (EventWrapper)
3. ‚úÖ –ö–æ–Ω—Å—Ç–∞–Ω—Ç—ã –≤–º–µ—Å—Ç–æ –º–∞–≥–∏—á–µ—Å–∫–∏—Ö —á–∏—Å–µ–ª
4. ‚úÖ –£–ª—É—á—à–µ–Ω–∏–µ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—à–∏–±–æ–∫

### –§–∞–∑–∞ 2: –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è (3-5 –¥–Ω–µ–π)
1. ‚úÖ RAII –¥–ª—è –≤—Å–µ—Ö OpenCL —Ä–µ—Å—É—Ä—Å–æ–≤
2. ‚úÖ –†–∞–∑–¥–µ–ª–µ–Ω–∏–µ FFTHandler –Ω–∞ –∫–ª–∞—Å—Å—ã
3. ‚úÖ –£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è step1/step2
4. ‚úÖ –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Å–æ–±—ã—Ç–∏–π

### –§–∞–∑–∞ 3: –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ (2-3 –¥–Ω—è)
1. ‚úÖ –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –≥–¥–µ –≤–æ–∑–º–æ–∂–Ω–æ
2. ‚úÖ Batch –æ–ø–µ—Ä–∞—Ü–∏–∏
3. ‚úÖ –ü—Ä–æ—Ñ–∏–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –±–µ–Ω—á–º–∞—Ä–∫–∏

---

## üö® –†–∏—Å–∫–∏ –∏ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è

### –†–∏—Å–∫–∏:
1. **–ò–∑–º–µ–Ω–µ–Ω–∏–µ –ø–æ–≤–µ–¥–µ–Ω–∏—è:** –ù—É–∂–Ω–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ—Å–ª–µ –∫–∞–∂–¥–æ–≥–æ —ç—Ç–∞–ø–∞
2. **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å:** –ù–æ–≤—ã–µ –∞–±—Å—Ç—Ä–∞–∫—Ü–∏–∏ –º–æ–≥—É—Ç –∑–∞–º–µ–¥–ª–∏—Ç—å –∫–æ–¥
3. **–°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å:** –ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞—Ö

### –ú–∏—Ç–∏–≥–∞—Ü–∏—è:
- –ü–æ—ç—Ç–∞–ø–Ω–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è —Å —Ç–µ—Å—Ç–∞–º–∏
- –ë–µ–Ω—á–º–∞—Ä–∫–∏ –¥–æ/–ø–æ—Å–ª–µ
- –û–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —á–µ—Ä–µ–∑ –∞–¥–∞–ø—Ç–µ—Ä—ã

---

## üìä –ú–µ—Ç—Ä–∏–∫–∏ —É—Å–ø–µ—Ö–∞

- ‚úÖ –°–æ–∫—Ä–∞—â–µ–Ω–∏–µ printf –Ω–∞ 80%+
- ‚úÖ –£–≤–µ–ª–∏—á–µ–Ω–∏–µ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –Ω–∞ 5-10%
- ‚úÖ –°–æ–∫—Ä–∞—â–µ–Ω–∏–µ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è –∫–æ–¥–∞ –Ω–∞ 30%+
- ‚úÖ –£–ª—É—á—à–µ–Ω–∏–µ –ø–æ–∫—Ä—ã—Ç–∏—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—à–∏–±–æ–∫
- ‚úÖ –£–ø—Ä–æ—â–µ–Ω–∏–µ –ø–æ–¥–¥–µ—Ä–∂–∫–∏ –∫–æ–¥–∞

---

## ‚ùì –í–æ–ø—Ä–æ—Å—ã –¥–ª—è –æ–±—Å—É–∂–¥–µ–Ω–∏—è

1. **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å vs –ß–∏—Ç–∞–µ–º–æ—Å—Ç—å:** –ö–∞–∫–æ–π –±–∞–ª–∞–Ω—Å?
2. **–û–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å:** –ù—É–∂–Ω–∞ –ª–∏ 100% —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å API?
3. **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:** –ö–∞–∫–æ–µ –ø–æ–∫—Ä—ã—Ç–∏–µ —Ç–µ—Å—Ç–∞–º–∏ —Ç—Ä–µ–±—É–µ—Ç—Å—è?
4. **–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç—ã:** –ö–∞–∫–∏–µ –æ–±–ª–∞—Å—Ç–∏ –∫—Ä–∏—Ç–∏—á–Ω–µ–µ –≤—Å–µ–≥–æ?

