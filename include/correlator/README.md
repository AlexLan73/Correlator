# üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ FFT Correlator

## üìã –û–±–∑–æ—Ä

–ü—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –∫–ª–∞—Å—Å–æ–≤ –¥–ª—è FFT –∫–æ—Ä—Ä–µ–ª—è—Ç–æ—Ä–∞, —Ä–∞–∑—Ä–∞–±–æ—Ç–∞–Ω–Ω–∞—è —Å —Å–æ–±–ª—é–¥–µ–Ω–∏–µ–º –ø—Ä–∏–Ω—Ü–∏–ø–æ–≤ –û–û–ü –∏ –ø–∞—Ç—Ç–µ—Ä–Ω–æ–≤ –ø—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è.

## üéØ –ü—Ä–∏–Ω—Ü–∏–ø—ã –ø—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

### SOLID –ø—Ä–∏–Ω—Ü–∏–ø—ã
- **S**ingle Responsibility: –∫–∞–∂–¥—ã–π –∫–ª–∞—Å—Å –∏–º–µ–µ—Ç –æ–¥–Ω—É –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å
- **O**pen/Closed: –æ—Ç–∫—Ä—ã—Ç –¥–ª—è —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è, –∑–∞–∫—Ä—ã—Ç –¥–ª—è –º–æ–¥–∏—Ñ–∏–∫–∞—Ü–∏–∏
- **L**iskov Substitution: –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã –º–æ–≥—É—Ç –±—ã—Ç—å –∑–∞–º–µ–Ω–µ–Ω—ã —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è–º–∏
- **I**nterface Segregation: –º–∞–ª–µ–Ω—å–∫–∏–µ, —Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã
- **D**ependency Inversion: –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å –æ—Ç –∞–±—Å—Ç—Ä–∞–∫—Ü–∏–π, –∞ –Ω–µ –æ—Ç –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã—Ö –∫–ª–∞—Å—Å–æ–≤

### –ü–∞—Ç—Ç–µ—Ä–Ω—ã –ø—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
- **Strategy Pattern**: `IFFTBackend` - –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –º–µ–∂–¥—É –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞–º–∏
- **Factory Pattern**: —Ñ–∞–±—Ä–∏—á–Ω—ã–µ –º–µ—Ç–æ–¥—ã –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –æ–±—ä–µ–∫—Ç–æ–≤
- **Builder Pattern**: `CorrelationPipeline` - –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ —Å–ª–æ–∂–Ω—ã—Ö –æ–±—ä–µ–∫—Ç–æ–≤
- **Observer Pattern**: –≤–∞–ª–∏–¥–∞—Ü–∏—è –∏ —ç–∫—Å–ø–æ—Ä—Ç –Ω–∞ –∫–∞–∂–¥–æ–º —ç—Ç–∞–ø–µ

## üì¶ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –∫–ª–∞—Å—Å–æ–≤

### –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã (I-prefix)

#### `IConfiguration`
–ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–ª—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –∫–æ—Ä—Ä–µ–ª—è—Ç–æ—Ä–∞.
- –•—Ä–∞–Ω–µ–Ω–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ (FFT size, num shifts, etc.)
- –í–∞–ª–∏–¥–∞—Ü–∏—è –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
- JSON —Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏—è

#### `IDataSnapshot`
–ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –ø—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö.
- –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –Ω–∞ –∫–∞–∂–¥–æ–º —ç—Ç–∞–ø–µ
- –≠–∫—Å–ø–æ—Ä—Ç –≤ JSON
- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –¥–∞–Ω–Ω—ã—Ö

#### `IFFTBackend`
–ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–ª—è FFT –±—ç–∫–µ–Ω–¥–∞ (Strategy Pattern).
- –ê–±—Å—Ç—Ä–∞–∫—Ü–∏—è –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã (OpenCL, CUDA, ROCm)
- –ú–µ—Ç–æ–¥—ã –¥–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è —à–∞–≥–æ–≤
- –ü–æ–ª—É—á–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤

#### `IDataValidator`
–ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–ª—è –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –¥–∞–Ω–Ω—ã—Ö.
- –í–∞–ª–∏–¥–∞—Ü–∏—è –Ω–∞ –∫–∞–∂–¥–æ–º —ç—Ç–∞–ø–µ
- –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–∑–º–µ—Ä–æ–≤, –¥–∏–∞–ø–∞–∑–æ–Ω–æ–≤ –∑–Ω–∞—á–µ–Ω–∏–π
- –°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Å —ç—Ç–∞–ª–æ–Ω–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏

#### `IResultExporter`
–ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–ª—è —ç–∫—Å–ø–æ—Ä—Ç–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤.
- –≠–∫—Å–ø–æ—Ä—Ç –≤ JSON –Ω–∞ –∫–∞–∂–¥–æ–º —ç—Ç–∞–ø–µ
- –§–∏–Ω–∞–ª—å–Ω—ã–π –æ—Ç—á–µ—Ç

### –†–µ–∞–ª–∏–∑–∞—Ü–∏–∏

#### `Configuration`
–†–µ–∞–ª–∏–∑–∞—Ü–∏—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ —Å –≤–∞–ª–∏–¥–∞—Ü–∏–µ–π.

#### `DataSnapshot`
–†–µ–∞–ª–∏–∑–∞—Ü–∏—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –ø—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö.

#### `DataValidator`
–†–µ–∞–ª–∏–∑–∞—Ü–∏—è –≤–∞–ª–∏–¥–∞—Ü–∏–∏ —Å –ø—Ä–æ–≤–µ—Ä–∫–∞–º–∏.

#### `ResultExporter`
–†–µ–∞–ª–∏–∑–∞—Ü–∏—è —ç–∫—Å–ø–æ—Ä—Ç–∞ –≤ JSON —Ñ–∞–π–ª—ã.

#### `CorrelationPipeline`
–ì–ª–∞–≤–Ω—ã–π –∫–ª–∞—Å—Å –¥–ª—è –æ—Ä–∫–µ—Å—Ç—Ä–∞—Ü–∏–∏ –≤—Å–µ–≥–æ pipeline.

## üîÑ Workflow

```
1. –°–æ–∑–¥–∞–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
   ‚Üì
2. –°–æ–∑–¥–∞–Ω–∏–µ –±—ç–∫–µ–Ω–¥–∞ (OpenCL)
   ‚Üì
3. –°–æ–∑–¥–∞–Ω–∏–µ pipeline
   ‚Üì
4. –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
   ‚Üì
5. Step 1: Reference FFT
   ‚îú‚îÄ –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ
   ‚îú‚îÄ –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ snapshot
   ‚îú‚îÄ –í–∞–ª–∏–¥–∞—Ü–∏—è
   ‚îî‚îÄ –≠–∫—Å–ø–æ—Ä—Ç –≤ JSON
   ‚Üì
6. Step 2: Input FFT
   ‚îú‚îÄ –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ
   ‚îú‚îÄ –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ snapshot
   ‚îú‚îÄ –í–∞–ª–∏–¥–∞—Ü–∏—è
   ‚îî‚îÄ –≠–∫—Å–ø–æ—Ä—Ç –≤ JSON
   ‚Üì
7. Step 3: Correlation
   ‚îú‚îÄ –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ
   ‚îú‚îÄ –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ snapshot
   ‚îú‚îÄ –í–∞–ª–∏–¥–∞—Ü–∏—è
   ‚îî‚îÄ –≠–∫—Å–ø–æ—Ä—Ç –≤ JSON
   ‚Üì
8. –§–∏–Ω–∞–ª—å–Ω—ã–π –æ—Ç—á–µ—Ç
```

## üìä JSON –≠–∫—Å–ø–æ—Ä—Ç

–ù–∞ –∫–∞–∂–¥–æ–º —ç—Ç–∞–ø–µ —Å–æ–∑–¥–∞—é—Ç—Å—è JSON —Ñ–∞–π–ª—ã —Å:
- –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–µ–π
- –ü—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏
- –†–µ–∑—É–ª—å—Ç–∞—Ç–∞–º–∏ –≤–∞–ª–∏–¥–∞—Ü–∏–∏
- –ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–º–∏ (timestamp, —Ä–∞–∑–º–µ—Ä—ã)

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ JSON —Ñ–∞–π–ª–∞

```json
{
  "step": "STEP1_REFERENCE_FFT",
  "timestamp": "2025-12-21 20:37:55",
  "configuration": {
    "fft_size": 32768,
    "num_shifts": 40,
    "num_signals": 50,
    "num_output_points": 5,
    "scale_factor": 0.000030518
  },
  "data": {
    "reference_fft": [
      {"real": 0.123, "imag": 0.456},
      ...
    ],
    "num_shifts": 40,
    "fft_size": 32768
  },
  "validation": {
    "is_valid": true,
    "error_count": 0,
    "warning_count": 0,
    "errors": [],
    "warnings": []
  }
}
```

## üöÄ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

### –ë–∞–∑–æ–≤—ã–π –ø—Ä–∏–º–µ—Ä

```cpp
#include "correlator/Correlator.hpp"

using namespace Correlator;

// 1. –°–æ–∑–¥–∞—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é
auto config = IConfiguration::createDefault();
config->setFFTSize(32768);
config->setNumShifts(40);
config->setNumSignals(50);

// 2. –°–æ–∑–¥–∞—Ç—å –±—ç–∫–µ–Ω–¥
auto backend = IFFTBackend::createOpenCLBackend();

// 3. –°–æ–∑–¥–∞—Ç—å pipeline
CorrelationPipeline pipeline(std::move(backend), std::move(config));

// 4. –ü–æ–¥–≥–æ—Ç–æ–≤–∏—Ç—å –¥–∞–Ω–Ω—ã–µ
std::vector<int32_t> reference_signal = generateMSequence(32768);
std::vector<int32_t> input_signals = generateMSequences(50, 32768);

// 5. –í—ã–ø–æ–ª–Ω–∏—Ç—å pipeline
if (pipeline.executeFullPipeline(reference_signal, input_signals)) {
    // 6. –ü–æ–ª—É—á–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
    const auto& snapshot = pipeline.getSnapshot();
    const auto& peaks = snapshot.getPeaks();
    
    // –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤...
}
```

### –ü–æ—à–∞–≥–æ–≤–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ

```cpp
// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
pipeline.initialize();

// Step 1
pipeline.executeStep1(reference_signal, 40);

// Step 2
pipeline.executeStep2(input_signals, 50);

// Step 3
pipeline.executeStep3(50, 40, 5);

// –ü–æ–ª—É—á–∏—Ç—å snapshot –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞
const auto& snapshot = pipeline.getSnapshot();
auto json = snapshot.toJSON(IDataSnapshot::Step::STEP1_REFERENCE_FFT);
```

## üîß –†–∞—Å—à–∏—Ä—è–µ–º–æ—Å—Ç—å

### –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤–æ–≥–æ –±—ç–∫–µ–Ω–¥–∞

1. –°–æ–∑–¥–∞—Ç—å –∫–ª–∞—Å—Å, –Ω–∞—Å–ª–µ–¥—É—é—â–∏–π `IFFTBackend`
2. –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –≤—Å–µ –≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã–µ –º–µ—Ç–æ–¥—ã
3. –î–æ–±–∞–≤–∏—Ç—å —Ñ–∞–±—Ä–∏—á–Ω—ã–π –º–µ—Ç–æ–¥ –≤ `IFFTBackend::createXXXBackend()`

–ü—Ä–∏–º–µ—Ä:
```cpp
class CUDAFFTBackend : public IFFTBackend {
    // –†–µ–∞–ª–∏–∑–∞—Ü–∏—è...
};

std::unique_ptr<IFFTBackend> IFFTBackend::createCUDABackend() {
    return std::make_unique<CUDAFFTBackend>();
}
```

### –ö–∞—Å—Ç–æ–º–Ω–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è

1. –°–æ–∑–¥–∞—Ç—å –∫–ª–∞—Å—Å, –Ω–∞—Å–ª–µ–¥—É—é—â–∏–π `IDataValidator`
2. –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –º–µ—Ç–æ–¥—ã –≤–∞–ª–∏–¥–∞—Ü–∏–∏
3. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≤ `CorrelationPipeline`

## üìù TODO

- [ ] –†–µ–∞–ª–∏–∑–∞—Ü–∏—è `OpenCLFFTBackend` (–æ–±–µ—Ä—Ç–∫–∞ –Ω–∞–¥ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º `FFTHandler`)
- [ ] –£–ª—É—á—à–µ–Ω–∏–µ JSON –ø–∞—Ä—Å–∏–Ω–≥–∞ –≤ `Configuration::fromJSON()`
- [ ] –î–æ–±–∞–≤–ª–µ–Ω–∏–µ unit-—Ç–µ—Å—Ç–æ–≤
- [ ] –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è Doxygen
- [ ] –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

## üë• –ê–≤—Ç–æ—Ä—ã

Senior Architecture Team

## üìÑ –õ–∏—Ü–µ–Ω–∑–∏—è

Internal use only

